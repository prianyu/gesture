/**
 * gesture v1.1.0 by prianYu
 * https://github.com/prianyu/gesture
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Gesture=e()}(this,function(){"use strict";function h(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function o(t){return Math.sqrt(t.x*t.x+t.y*t.y)}var n={getTarget:function(t,e){for(;void 0!==t&&null!=t&&"BODY"!==t.tagName.toUpperCase();){if(t.matches(e))return t;t=t.parentNode}return null},getLength:o,getAngle:function(t,e){var i,s,h=o(t)*o(e);return h?(i=(t.x*e.x+t.y*e.y)/h,s=Math.acos(Math.min(i,1)),180*(s=0<a.x*b.y-b.x*a.y?-s:s)/Math.PI):0},isFunction:function(t){return"function"==typeof t}},u=Math.abs;return function(){function i(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.target=t instanceof HTMLElement?t:"string"==typeof t?document.querySelector(t):null,this.target&&(this.selector=e,this._init())}var t,e,s;return t=i,(e=[{key:"_init",value:function(){this.params={zoom:1,deltaX:0,deltaY:0,diffX:0,diffY:0,angle:0,direction:""},this._initMetas(),this._initEvents()}},{key:"_initMetas",value:function(){this.pretouch={},this.preVector={x:null,y:null},this.touch={},this.movetouch={},this.distance=30}},{key:"_initEvents",value:function(){this.handles={},this._touch=this._touch.bind(this),this._move=this._move.bind(this),this._end=this._end.bind(this),this._cancel=this._cancel.bind(this),this.target.addEventListener("touchstart",this._touch,!1),this.target.addEventListener("touchmove",this._move,!1),this.target.addEventListener("touchend",this._end,!1),this.target.addEventListener("touchcancel",this._cancel,!1)}},{key:"_touch",value:function(t){var e,i=this,s=t.touches?t.touches[0]:t,h=this.touch,o=Date.now();this.e=t.target,h.startX=s.pageX,h.startY=s.pageY,this.startTime=o,this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),this.doubleTap=!1,this._emit("touch",t),1<t.touches.length?(e=t.touches[1],this.preVector={x:e.pageX-this.touch.startX,y:e.pageY-this.touch.startY},this.startDistance=n.getLength(this.preVector),this._emit("multitouch",t)):(this.longTapTimeout=setTimeout(function(){i._emit("longtap",t),i.doubleTap=!1,t.preventDefault()},~~this.longtapTime||800),this.doubleTap=this.pretouch.time&&o-this.pretouch.time<300&&u(this.touch.startX-this.pretouch.startX)<30,this.pretouch={startX:this.touch.startX,startY:this.touch.startY,time:this.touch.startTime})}},{key:"_move",value:function(t){var e,i,s,h,o=t.touches?t.touches[0]:t;this._emit("move",t),1<t.touches.length?(i={x:(e=t.touches[1]).pageX-o.pageX,y:e.pageY-o.pageY},this._emit("multimove",t),null!==this.preVector.x&&(this.startDistance&&(this.params.zoom=n.getLength(i)/this.startDistance,this._emit("pinch",t)),this.params.angle=n.getAngle(i,this.preVector),this._emit("rotate",t)),this.preVector.x=i.x,this.preVector.y=i.y):(s=o.pageX-this.touch.startX,h=o.pageY-this.touch.startY,this.params.diffY=h,this.params.diffX=s,this.movetouch.x?(this.params.deltaX=o.pageX-this.movetouch.x,this.params.deltaY=o.pageY-this.movetouch.y):this.params.deltaX=this.params.deltaY=0,(30<u(s)||30<u(h))&&(this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),this.doubleTap=!1),this._emit("slide",t),this.movetouch.x=o.pageX,this.movetouch.y=o.pageY),1<t.touches.length&&t.preventDefault()}},{key:"_end",value:function(t){var e=this,i=Date.now(),s=~~((this.movetouch.x||0)-this.touch.startX),h=~~((this.movetouch.y||0)-this.touch.startY),o=this.params;this._emit("end",t),this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.movetouch.x&&(u(s)>this.distance||this.movetouch.y&&u(h)>this.distance)?(this._emit("swipe",t),u(s)<u(h)?h<0?(this._emit("swipeUp",t),o.direction="up"):(this._emit("swipeDown",t),o.direction="down"):s<0?(this._emit("swipeLeft",t),o.direction="left"):(this._emit("swipeRight",t),o.direction="right"),this._emit("finish",t)):!this.doubleTap&&i-this.touch.startTime<300?this.tapTimeout=setTimeout(function(){e._emit("tap",t),e._emit("finish",t)},300):(this.doubleTap&&(this._emit("dbtap",t),this.tapTimeout&&clearTimeout(this.tapTimeout)),this._emit("finish",t)),this._initMetas()}},{key:"_cancel",value:function(t){this._emit("cancel",t),this._end()}},{key:"_emit",value:function(t,e){var i=this.handles[t]||[];if(0!==i.length&&(this.selector&&(this.params.selector=n.getTarget(this.e,this.selector)),this.params.selector||!this.selector))for(var s=0,h=i.length;s<h;s++)i[s](e,this.params)}},{key:"on",value:function(t,e){return this.handles[t]||(this.handles[t]=[]),n.isFunction(e)&&this.handles[t].push(e),this}},{key:"off",value:function(t,e){var i=this.handles[t];if(e)for(var s=0,h=i.length;s<h;s++)i[s]===e&&i.splice(s,1);else this.handles[t]=[]}},{key:"destroy",value:function(){var e=this,t=this.target;this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),t.removeEventListener("touchstart",this._touch),t.removeEventListener("touchmove",this._move),t.removeEventListener("touchend",this._end),t.removeEventListener("touchcancel",this._cancel).touch.map(function(t){e[t]=null})}},{key:"set",value:function(t){for(var e in t)"distance"===e&&(this.distance=~~t[e]),"longtapTime"===e&&(this.longtapTime=Math.max(500,~~t[e]));return this}}])&&h(t.prototype,e),s&&h(t,s),i}()});
